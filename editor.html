<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Editor - Peri√≥dico Digital</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Editor</h1>
  </header>

  <!-- Men√∫ del editor -->
  <nav class="editor-nav">
    <button id="publishArticleBtn" title="Publicar art√≠culo"><span>üöÄ</span></button>
    <button id="draftsBtn" title="Ver borradores"><span>üíæ</span></button>
    <button id="logoutBtn" title="Cerrar sesi√≥n"><span>üîí</span></button>
  </nav>

  <main class="editor-main">
    <section id="newArticleSection" class="editor-content">
      <h2>Publicar Nuevo Art√≠culo</h2>
      <!-- Campo para el t√≠tulo -->
      <label for="articleTitle">T√≠tulo del Art√≠culo:</label>
      <input type="text" id="articleTitle" placeholder="Ingresa el t√≠tulo aqu√≠">

      <!-- Toolbar sticky con botones de formato -->
      <div class="editor-toolbar">
        <button type="button" onclick="formatText('bold')" title="Negrita"><strong>N</strong></button>
        <button type="button" onclick="formatText('italic')" title="Cursiva"><em>C</em></button>
        <button type="button" onclick="formatText('underline')" title="Subrayado"><span style="text-decoration: underline;">S</span></button>
        <button type="button" onclick="formatText('justifyLeft')" title="Alinear izquierda">‚¨ÖÔ∏è</button>
        <button type="button" onclick="formatText('justifyCenter')" title="Centrar">‚ÜîÔ∏è</button>
        <button type="button" onclick="formatText('justifyRight')" title="Alinear derecha">‚û°Ô∏è</button>
        <button type="button" onclick="formatText('justifyFull')" title="Justificar">‚öñÔ∏è</button>
        <button type="button" onclick="insertImage()" title="Insertar Imagen">üñºÔ∏è</button>
        <button type="button" onclick="publishArticle()" title="Publicar">üöÄ</button>
        <button type="button" onclick="saveDraft()" title="Guardar borrador">üíæ</button>
      </div>

      <!-- √Årea editable para el contenido -->
      <div id="editor" class="editor-area" contenteditable="true">
        Escribe aqu√≠ tu art√≠culo...
      </div>

      <!-- Campo para etiquetas -->
      <label for="tags">Etiquetas (separadas por coma):</label>
      <input type="text" id="tags" placeholder="ej. pol√≠tica, econom√≠a, deportes">

      <!-- Campo para cargar la imagen -->
      <input type="file" id="imageInput" style="display: none;" accept="image/*">
      <label for="imageInput" id="imageLabel" style="cursor: pointer;">Subir Imagen</label>
    </section>
  </main>

  <script src="main.js"></script>
  <script>
    // Verificar si el usuario est√° autenticado (simulaci√≥n usando localStorage)
    if (!localStorage.getItem('loggedIn')) {
      // Si no est√° autenticado, redirigir a la p√°gina p√∫blica
      window.location.href = "index.html";
    }

    // Funci√≥n para formatear el texto
    function formatText(command) {
      document.execCommand(command, false, null);
    }

    // Funci√≥n para insertar una imagen en el contenido del art√≠culo
    function insertImage() {
      const imageInput = document.getElementById('imageInput');
      imageInput.click(); // Simular clic en el input para cargar la imagen
    }

    // Cuando el usuario selecciona una imagen
    document.getElementById('imageInput').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          const img = new Image();
          img.src = e.target.result;
          img.style.maxWidth = '100%'; // Ajustar la imagen al tama√±o del contenedor
          
          // Insertar la imagen en la posici√≥n actual del cursor
          const editor = document.getElementById('editor');
          const caption = prompt("Escribe el ep√≠grafe para la imagen:");
          
          // Crear un contenedor para la imagen y su ep√≠grafe
          const imageWrapper = document.createElement('div');
          imageWrapper.style.textAlign = 'center';
          
          // Insertar la imagen
          imageWrapper.appendChild(img);
          
          // Insertar el ep√≠grafe si se proporcion√≥
          if (caption) {
            const captionElement = document.createElement('p');
            captionElement.style.fontSize = '0.9em';
            captionElement.style.color = '#555';
            captionElement.innerText = caption;
            imageWrapper.appendChild(captionElement);
          }

          // Insertar el contenedor con la imagen y ep√≠grafe en el √°rea de edici√≥n
          editor.appendChild(imageWrapper);
        };

        reader.readAsDataURL(file); // Convertir la imagen a base64
      }
    });

    // Funci√≥n para guardar el borrador
    function saveDraft() {
      const title = document.getElementById('articleTitle').value;
      const content = document.getElementById('editor').innerHTML;
      const tags = document.getElementById('tags').value.split(',');

      const draft = {
        title: title,
        content: content,
        tags: tags,
        date: new Date().toLocaleString(),
      };

      // Guardar el borrador en localStorage
      let drafts = JSON.parse(localStorage.getItem('drafts') || '[]');
      drafts.push(draft);
      localStorage.setItem('drafts', JSON.stringify(drafts));
      alert('Borrador guardado');
    }

    // Funci√≥n para publicar el art√≠culo
    function publishArticle() {
      const title = document.getElementById('articleTitle').value;
      const content = document.getElementById('editor').innerHTML;
      const tags = document.getElementById('tags').value.split(',');

      const article = {
        title: title,
        content: content,
        tags: tags,
        date: new Date().toLocaleString(),
        published: true,
      };

      // Aqu√≠ podr√≠as enviar el art√≠culo a un servidor o procesarlo de alguna manera
      console.log('Art√≠culo publicado:', article);
      alert('Art√≠culo publicado');
    }
  </script>
</body>
</html>
